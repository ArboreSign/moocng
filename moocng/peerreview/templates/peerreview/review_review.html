{% extends "courses/base_course.html" %}

{% load i18n peer_review_tags %}

{% block nav-course-reviews %}class="active"{% endblock %}

{% block extrajs %}
    <script type="text/javascript">
        $(document).ready(function () {
            "use strict";
            var confirmModal;

            $('a.criterion_tooltip').tooltip();
            $('input.criterion_value').each(function (index, item) {
                $(item).parent().find('button[data-value=' + $(item).val() + ']').addClass('active');
            });
            $('button.criterion_value').click(function (event) {
                var target = $(event.target),
                    input;
                if (!target.attr('data-name')) {
                    target = $(target.parent());
                }
                input = $('input[name=' + target.attr('data-name') + ']');
                input.val(target.attr('data-value'));
            });
            $('input#send_review').click(function (evt) {
                evt.preventDefault();
                evt.stopPropagation();
                if (confirmModal === undefined) {
                    confirmModal = $("#confirm-review").modal({
                        show: false,
                        backdrop: "static",
                        keyboard: false
                    });
                }
                confirmModal.modal("show");
            });
            $("button#pr-confirm").click(function (evt) {
                confirmModal.modal("hide");
                $('form').trigger("submit");
            });
        });
    </script>
{% endblock %}

{% block content %}
<div id="confirm-review" class="modal hide fade">
    <div class="modal-header">
        <h3>{% trans "Confirm submission" %}</h3>
    </div>
    <div class="modal-body">
        <p>{% trans "Are you completely sure you want to submit your review? You can't change it later, this will be your final review of this student's assignment." %}</p>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn" data-dismiss="modal">{% trans "Cancel" %}</button>
        <button type="button" class="btn btn-danger" id="pr-confirm">{% trans "Send" %}</button>
    </div>
</div>

<h2>{% trans "Review" %}</h2>

<div class="span12">
    <div class="span5">
        <h3>{% trans "Activity description" %}</h3>
        {{ assignment.description|safe }}
    </div>

    <div class="span5">
        <h3>{% trans "Student response" %}</h3>
        {{ submission.text }}
        <a href="{{ submission.file }}">{% trans "Attachment" %}</a>
    </div>
</div>

<h3>{% trans "Your review" %}</h3>

<form method="post">
    <div class="clearfix">
       {% csrf_token %}
       {{ criteria_formset.management_form }}
       <div class="span6">
           {% for criterion in criteria_formset %}
               {{ criterion.evaluation_criterion_id }}
               <div class="clearfix well well-small">
                   <p><a class="label criterion_tooltip" data-toggle="tooltip" title data-original-title="{{ criterion.evaluation_criterion_id.value|get_criterion_description }}">{{ criterion.evaluation_criterion_id.value|get_criterion_title }}</a></p>
                   <div class="btn-group pull-right" data-toggle="buttons-radio">
                       <button type="button" data-name="{{ criterion.value.html_name }}" data-value="" class="btn btn-warning criterion_value disabled"><i class="icon-minus"></i></button>
                       {% for choice in criterion.value %}
                           <button type="button" data-name="{{ criterion.value.html_name }}" data-value="{{ choice.choice_value }}" class="btn criterion_value">{{ choice.choice_label }}</button>
                       {% endfor %}
                       <input type="hidden" class="criterion_value" name="{{ criterion.value.html_name }}" value="{% if criterion.value.value %}{{ criterion.value.value }}{% endif %}">
                       <button type="button" data-name="{{ criterion.value.html_name }}" data-value="" class="btn btn-success criterion_value disabled"><i class="icon-plus"></i></button>
                   </div>
                   {{ criterion.value.errors }}
               </div>
           {% endfor %}
       </div>
       <div class="span5 well well-small">
           {{ submission_form }}
       </div>
    </div>
    <div class="form-actions">
        <input type="submit" class="btn btn-primary" id="send_review" value="{% trans "Send review" %}" />
    </div>
</form>

{% endblock %}
